/**
 * ceil(log2(x))
 * log2(x) = y <=> 2 ^ y = x
 */

#include <stdio.h>
#include <limits.h>
#include "common.h"

#define MAXBITS cast_int(sizeof(int) * CHAR_BIT - 1)

int ceillog2(unsigned int x)
{
	static const byte log_2[256] = {
		// 记录x:[1,256]ceil(log2(x))的值
		// x=1,y=0;x=2,y=1;x=3,y=2;x=4,y=2....
		0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
	    6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
	    7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	    7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	    8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,
	    8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,
	    8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,
	    8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8
	};
	int l = 0;
	x--;
	while (x >= 256) {l += 8; x >>= 8;}
	return l + log_2[x];
}

#ifdef TEST_2

int main(int argc, char const *argv[])
{
	// 类似求余数，前24位直接判断，后8位根据log_2判断
	int i = 0;
	for (; i < 100; i++) {
		printf("ceil log2(%d) = %d\n", i, ceillog2(i));
	}

	return 0;
}

#endif /* TEST */
